# Telegram-ассистент для предоставления расписания СЗГМУ имени И. И. Мечникова

## Команда проекта

* **[Багрова Анастасия](https://github.com/bagrova-av)** — группа 5130904/30102
* **[Мальцев Александр](https://github.com/gurumbay)** — группа 5130904/30102
* **[Романчук Кирилл](https://github.com/Kirill-Romanchuk)** — группа 5130904/30102

---

## Определение проблемы

Студенты СЗГМУ имени И. И. Мечникова испытывают сложности при отслеживании и использовании актуального расписания занятий. Официальный сайт университета предоставляет расписание в неудобном для восприятия формате, не поддерживает механизм избранного и не уведомляет пользователей об изменениях, что приводит к потере времени и повышает риск пропуска или неверной интерпретации занятий.

<details>
  <summary><b>Пример расписания с официального сайта</b></summary>
  
  
  ![Официальное расписание](/images/official_schedule_example.png)
  
  
</details>

---

## Пользовательские сценарии

<details> <summary><b>1. Получение расписания на день</b></summary>

**Когда** я нахожусь в университете между парами и пытаюсь понять, куда идти дальше,
**я хочу** быстро и без лишних кликов получить своё расписание на сегодняшний день в понятном и структурированном виде без необходимости искать информацию на сайте,
**чтобы** экономить время и всегда видеть актуальные данные о времени и месте занятий.

</details> <details> <summary><b>2. Просмотр расписания на неделю</b></summary>

**Когда** начинается новая учебная неделя,
**я хочу** одним запросом получить полное и чётко структурированное расписание своей группы на всю неделю,
**чтобы** быстро спланировать своё время и не разбираться в трудночитаемой таблице на официальном сайте, рискуя ошибиться.

</details> <details> <summary><b>3. Избранные группы</b></summary>

**Когда** я регулярно смотрю расписание одной и той же группы или нескольких групп,
**я хочу** иметь возможность сохранять их в избранные,
**чтобы** каждый раз не вводить данные заново и получать расписание быстрее и удобнее.

</details>

---

## Архитектура проекта

### Характер нагрузки

* **Оценочное число пользователей:** ~2 500 активных пользователей в сутки
* **Период хранения данных:** не менее 5 лет (т.к. расписание может использоваться для анализа учебного процесса, восстановления исторических данных и статистики)

#### Соотношение R/W нагрузки

* Чтение: ~90% — регулярные запросы расписания
* Запись: ~10% — обновление расписаний, регистрация пользователей, обновление настроек

#### Объёмы трафика

* Средний размер запроса: ~0,25 КБ
* Средний размер ответа: ~3 КБ
* Среднее число запросов на пользователя в сутки: 3

**Входящий трафик:** ~1,8 МБ/сутки

**Исходящий трафик:** ~22 МБ/сутки

#### Объёмы дисковой системы

Оценочный объём базы данных за 5 лет с учётом индексов составляет ~360 МБ. Для обеспечения устойчивой работы рекомендуется выделить 1–2 ГБ дискового пространства.

---

### Архитектурные диаграммы (C4 Model)

#### Диаграмма контекста

![C4 Context](/images/С4-Context.png)

#### Диаграмма контейнеров

![C4 Containers](/images/С4-Containers.png)

---

### Контракты API и нефункциональные требования

Telegram-бот взаимодействует с внешним API расписания занятий.

* **Ожидаемое время ответа сервиса:** не более 2 секунд

---

### Схема базы данных

![ERD](/images/ERD.png)

Схема базы данных оптимизирована под преимущественно читающую нагрузку. Использование индексов обеспечивает соответствие нефункциональным требованиям по времени отклика.

---

### Масштабирование сервиса

При росте нагрузки до ~8 000 пользователей в сутки применимы следующие меры:

* **Вертикальное масштабирование:** увеличение CPU и RAM приложения и СУБД
* **Горизонтальное масштабирование:** несколько инстансов приложения и репликация PostgreSQL
* **Оптимизация хранения:** партиционирование таблицы занятий по периодам

---

## Запуск приложения

### Быстрый старт

1. Скопируйте пример файла конфигурации окружения:

    ```bash
    cp .env.example .env
    ```

    При необходимости отредактируйте значения переменных окружения (в частности, `BOT_TOKEN`).

2. Соберите и запустите сервисы:

    ```bash
    docker compose up -d --build
    ```

    В результате будут запущены следующие контейнеры:

    * `bot` — Telegram-бот
    * `db` — база данных PostgreSQL
    * `redis` — кэш и вспомогательное хранилище

    При старте контейнера `bot` автоматически применяются миграции базы данных
    (`alembic upgrade head`).

3. Для просмотра логов приложения выполните:

    ```bash
    docker compose logs -f bot
    ```

4. Остановка сервисов и удаление созданных ресурсов:

    ```bash
    docker compose down -v
    ```

---

## Локальная разработка

Данный режим предназначен для разработки и отладки без запуска контейнера приложения.

### Требования

* Python **>= 3.14**

### Инструкция по запуску

1. Создайте и активируйте виртуальное окружение:

    ```bash
    python -m venv .venv

    # PowerShell
    .\.venv\Scripts\Activate.ps1

    # bash
    source .venv/bin/activate
    ```

2. Установите зависимости проекта, включая пакеты для разработки, тестирования и линтинга:

    ```bash
    python -m pip install --upgrade pip
    python -m pip install -e ".[dev,lint,test]"
    ```

3. Создайте файл конфигурации окружения:

    ```bash
    cp .env.example .env
    ```

    Укажите необходимые значения переменных окружения, включая `BOT_TOKEN`.

4. Запустите внешние сервисы (PostgreSQL и Redis), например, с помощью Docker:

    ```bash
    docker compose up -d db redis
    ```

5. Примените миграции базы данных:

    ```bash
    alembic upgrade head
    ```

6. Запустите Telegram-бот в режиме разработки:

    ```bash
    python src/main.py
    ```

---

## Полезные команды

* Запуск тестов локально:

  ```bash
  pytest
  ```

* Проверка типов:

  ```bash
  mypy
  ```

* Линтинг и форматирование кода:

  ```bash
  ruff check --fix
  ruff format
  ```

* Установка git-хуков:

  ```bash
  pre-commit install
  ```